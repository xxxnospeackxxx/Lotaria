<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Lucky 0‚Äì100</title>

  <!-- PWA / mobile niceties -->
  <meta name="theme-color" content="#0b0f17" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    :root{
      --bg:#0b0f17;
      --card:#121a2a;
      --text:#e9eefc;
      --muted:#9fb0d0;
      --border:#22304a;
      --glow:#ffd34d;
      --win:#4dffb5;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, #152042 0%, var(--bg) 55%);
      color: var(--text);
      overflow-x:hidden;
    }

    .wrap{
      max-width: 1100px;
      margin: 16px auto;
      padding: 14px;
    }

    h1{
      text-align:center;
      margin: 8px 0 14px;
      font-size: 22px;
      font-weight: 900;
      letter-spacing: .4px;
    }

    .card{
      border:1px solid var(--border);
      background: rgba(18,26,42,.75);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
    }

    .top{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }

    /* ‚úÖ 16px para evitar zoom no iPhone */
    input{
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(10,14,25,.6);
      color: var(--text);
      width: 280px;
      max-width: 92vw;
      font-size: 16px;
      outline:none;
    }
    input::placeholder{ color:#7f90b3; }

    button{
      padding: 12px 18px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, #1a2744, #111a30);
      color: var(--text);
      font-weight: 900;
      font-size: 15px;
      cursor:pointer;
    }
    button:disabled{ opacity:.55; cursor:not-allowed; }

    .msg{
      text-align:center;
      margin: 10px 0 12px;
      font-size: 15px;
      opacity:.92;
      min-height: 20px;
    }

    /* ‚úÖ Grid centrada e consistente */
    .grid{
      display:grid;
      grid-template-columns: repeat(11, 1fr);
      gap: 10px;
      max-width: 740px;
      margin: 0 auto;
    }

    .cell{
      height: 52px;
      border-radius: 14px;
      border:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      font-size: 16px;
      background: rgba(18,26,42,.55);
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      user-select:none;
    }

    .cell.active{
      border-color: var(--glow);
      box-shadow: 0 0 18px rgba(255,211,77,.45);
      transform: scale(1.06);
    }

    .cell.winner{
      border-color: var(--win);
      box-shadow: 0 0 26px rgba(77,255,181,.55);
      transform: scale(1.12);
    }

    /* ‚úÖ Overlay gigante por cima de tudo */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(5,8,16,.65);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:10000;
      padding: 18px;
    }
    .overlay.hidden{ display:none; }

    .overlayBox{
      text-align:center;
      padding: 18px 18px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(18,26,42,.70);
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      animation: sway 1.1s ease-in-out infinite;
      transform-origin:center;
      max-width: 92vw;
    }

    .overlayTitle{
      font-size: clamp(26px, 5vw, 54px);
      font-weight: 1000;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .overlayNum{
      font-size: clamp(78px, 12vw, 140px);
      font-weight: 1100;
      color: var(--win);
      text-shadow: 0 0 30px rgba(77,255,181,.5);
    }

    @keyframes sway{
      0%   { transform: translateX(-14px) scale(1.00); }
      50%  { transform: translateX(14px)  scale(1.10); }
      100% { transform: translateX(-14px) scale(1.00); }
    }

    /* Confetti */
    canvas{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:9999;
    }

    /* ‚úÖ Ajustes mobile */
    @media (max-width: 520px){
      .grid{ grid-template-columns: repeat(10, 1fr); gap: 8px; max-width: 95vw; }
      .cell{ height: 44px; font-size: 14px; border-radius: 12px; }
      button{ width: 140px; }
    }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>

  <div id="overlay" class="overlay hidden" aria-hidden="true">
    <div class="overlayBox">
      <div class="overlayTitle">CONGRATULATIONS</div>
      <div id="overlayNum" class="overlayNum">‚Äî</div>
    </div>
  </div>

  <div class="wrap">
    <h1>Lucky 0‚Äì100</h1>

    <div class="card">
      <div class="top">
        <input id="username" placeholder="@telegram" autocomplete="off" autocapitalize="none" />
        <button id="play">‚ñ∂ PLAY</button>
        <button id="reset">RESET</button>
      </div>

      <div class="msg" id="msg">Enter your Telegram username and press PLAY</div>
      <div id="grid" class="grid" aria-label="Number grid"></div>
    </div>
  </div>

  <script>
    /* üîê PASSWORD */
    const PAGE_PASSWORD = "BigWinForMe";
    const p = prompt("üîí Protected page\n\nEnter password:");
    if (p !== PAGE_PASSWORD) {
      document.body.innerHTML = "<h1 style='text-align:center;margin-top:50px;font-family:system-ui;'>‚ùå Access denied</h1>";
      throw new Error("Denied");
    }

    /* üéØ CONFIG */
    const LUCK_MAP = { "luck0100": 37 }; // token -> n√∫mero vencedor
    const token = new URLSearchParams(location.search).get("luck");
    const WINNER = LUCK_MAP[token];

    // ‚úÖ 15s (n√£o mostrado em lado nenhum)
    const DURATION = 15000;

    /* ELEMENTS */
    const grid = document.getElementById("grid");
    const msg = document.getElementById("msg");
    const userEl = document.getElementById("username");
    const playBtn = document.getElementById("play");
    const resetBtn = document.getElementById("reset");
    const overlay = document.getElementById("overlay");
    const overlayNum = document.getElementById("overlayNum");
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");

    let cells = [];
    let active = -1;
    let spin = null;
    let stopTimer = null;

    /* BUILD GRID 0..100 */
    for (let i = 0; i <= 100; i++) {
      const d = document.createElement("div");
      d.className = "cell";
      d.textContent = i;
      grid.appendChild(d);
      cells.push(d);
    }

    function normalizeUser(s){
      const t = (s || "").trim();
      if (!t) return "";
      return t.startsWith("@") ? t : ("@" + t);
    }

    function clearState(){
      cells.forEach(c => c.classList.remove("active", "winner"));
      active = -1;
      hideOverlay();
      stopConfetti();
      playBtn.disabled = false;
      userEl.disabled = false;
      msg.textContent = "Enter your Telegram username and press PLAY";
    }

    function showOverlay(n){
      overlayNum.textContent = String(n);
      overlay.classList.remove("hidden");
      overlay.setAttribute("aria-hidden", "false");
    }

    function hideOverlay(){
      overlay.classList.add("hidden");
      overlay.setAttribute("aria-hidden", "true");
    }

    playBtn.onclick = () => {
      if (!WINNER) { msg.textContent = "Invalid link."; return; }

      const user = normalizeUser(userEl.value);
      if (!user) { msg.textContent = "Enter your Telegram username."; return; }

      msg.textContent = "Good luck‚Ä¶";
      playBtn.disabled = true;
      userEl.disabled = true;
      hideOverlay();
      stopConfetti();
      cells.forEach(c => c.classList.remove("active","winner"));

      spin = setInterval(() => {
        if (active >= 0) cells[active].classList.remove("active");
        active = Math.floor(Math.random() * cells.length);
        cells[active].classList.add("active");
      }, 60);

      stopTimer = setTimeout(() => finish(user), DURATION);
    };

    function finish(user){
      clearInterval(spin);
      spin = null;
      clearTimeout(stopTimer);
      stopTimer = null;

      cells.forEach(c => c.classList.remove("active","winner"));
      cells[WINNER].classList.add("winner");
      cells[WINNER].scrollIntoView({ behavior: "smooth", block: "center", inline: "center" });

      showOverlay(WINNER);
      confetti(260);

      // msg discreta (n√£o mostra tempo)
      msg.textContent = `Winner: ${WINNER} ‚Äî ${user}`;

      // overlay some sozinho depois de 6.5s (opcional)
      setTimeout(() => hideOverlay(), 6500);

      playBtn.disabled = false;
      userEl.disabled = false;
    }

    resetBtn.onclick = () => location.reload();

    /* CONFETTI */
    let confettiAnim = null;

    function confetti(count){
      canvas.width = innerWidth;
      canvas.height = innerHeight;

      let parts = Array.from({length:count}, () => ({
        x: Math.random() * canvas.width,
        y: -20 - Math.random()*120,
        vx: -2 + Math.random()*4,
        vy: 2 + Math.random()*6,
        g: 0.03 + Math.random()*0.02,
        life: 220 + Math.floor(Math.random()*120),
        c: `hsl(${Math.random()*360}, 90%, 60%)`,
        r: 3 + Math.random()*4
      }));

      if (confettiAnim) cancelAnimationFrame(confettiAnim);

      function tick(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for (const p of parts){
          p.x += p.vx;
          p.y += p.vy;
          p.vy += p.g;
          p.life -= 1;

          ctx.fillStyle = p.c;
          ctx.fillRect(p.x, p.y, p.r*2, p.r);
        }
        parts = parts.filter(p => p.life > 0 && p.y < canvas.height + 60);

        if (parts.length){
          confettiAnim = requestAnimationFrame(tick);
        } else {
          stopConfetti();
        }
      }
      tick();
    }

    function stopConfetti(){
      if (confettiAnim) cancelAnimationFrame(confettiAnim);
      confettiAnim = null;
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }

    window.addEventListener("resize", () => {
      // se estiver a cair confetti, ajusta o canvas
      canvas.width = innerWidth;
      canvas.height = innerHeight;
    });

    // init
    clearState();
  </script>
</body>
</html>
